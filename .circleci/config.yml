version: 2.1

jobs:
  build:
    docker:
      - image: "circleci/python:3.10.1"
    steps:
      - checkout
      - run: python3 src/my_sum.py
  unit-test:
    docker:
      - image: "circleci/python:3.10.1"
    steps:
      - checkout
      - run: python -m unittest test
  integration-test:
    docker:
      - image: "circleci/python:3.10.1"
    steps:
      - checkout
      - run: echo "integration test started"
      - run: echo "integration test completed"
  component-test:
    docker:
      - image: "circleci/python:3.10.1"
    steps:
      - checkout
      - run: echo "integration test started"
      - run: echo "integration test completed"
  deploy-dev:
    docker:
      - image: "circleci/python:3.10.1"
    steps:
      - checkout
      - run: echo "deployment started in $CURRENT_ENV"
      - run: echo "deployment successful"
  deploy-prod:
    docker:
      - image: "circleci/python:3.10.1"
    steps:
      - checkout
      - run: echo "deployment started in $CURRENT_ENV"
      - run: echo "deployment successful"
workflows:
  main:
    jobs:
      - build
      - unit-test:
          requires:
            - build
      - integration-test:
          requires:
            - build
      - component-test:
          requires:
            - build
      - deploy-dev:
          context: demo-dev
          requires:
            - test
      - approve-deploy-to-prod:
          type: approval
          requires:
            - deploy-dev
      - deploy-prod:
          context: demo-prod
          requires:
            - approve-deploy-to-prod